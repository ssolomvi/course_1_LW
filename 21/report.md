# Отчет по лабораторной работе N 21 по курсу
# "Фундаментальная информатика"

Студентка группы: M8О-113Б, Соломатина Светлана Викторовна\
Контакты: ssolomvi@gmail.com\
Работа выполнена: 05.05.2022\
Преподаватель: Довженко Анастасия Александровна

## 1. Тема

Программирование на интерпретируемых командных языках.

## 2. Цель работы

Составить программу выполнения заданных действий над файлами на одном из интерпретируемых языков ОС UNIX.

## 3. Задание

Вариант 10. Сравнение указанного файла со всеми другими файлами, имеющими такой же суффикс, с удалением совпадающих файлов. Программа должна обеспечивать возможность установки режима трассировки, а также позиционный способ задания параметров (список слов через пробел или запятую). Если указан параметр "-?", то выводится подсказка (спецификация программы).

## 4. Оборудование

Процессор: AMD Ryzen 5 4500U with Radeon Graphics 2.38 GHz\
ОП: 16384 Мб\
ОЗУ: 512 Гб\
Монитор: 1920x1080

## 5. Программное обеспечение

Операционная система семейства: **linux (mint cinnamon)**, версия **20.03**\
Интерпретатор команд: **bash**, версия **5.1.4**.\
Местонахождение и имена файлов программ и данных на домашнем компьютере: **/home/mint**

## 6. Идея, метод, алгоритм решения задачи

1. Проверять каждый параметр на наличие ',' и удалять ',' с помощью UNIX-утилиты для преобразования символов tr;
2. Поочерёдно обрабатывать аргументы из стандартного ввода командной строки с помощью структуры case-esac, там же реализовать условия вызова режима трассировки, меню программы;
3. В основном теле программы выполнить алгоритм для задания: с помощью команды выборки отдельных полей из строк файла cut извлечь суффикс заданного файла, а воспользовавшись утилитами для поиска find и grep, а также утилиты для сравнения cmp, определить все подходящие для удаления файлы, если есть таковые, и удалить;
4. Предусмотреть большинство случаев ошибок пользователя при работе с программой;
5. Вывести отчёт о работе программы: были ли удалены файлы или нет;

## 7. Сценарий выполнения работы

1. Изучить материалы лекции, дополнительные источники
2. Составить алгоритм к заданию
3. Реализовать алгоритм
4. Провести тесты
5. Запротоколировать сеанс

Тесты вынесены в отдельный файл "Tests" репозитория /lab21-ssolomvi. Для проведения тестов создаются файлы с одинаковыми и уникальными суффиксами, используется позиционный способ задания параметров, режим трассировки; проверяется отзыв программы на заведомо ложные вызовы.

## 8. Распечатка протокола

```bash
#! /bin/bash

tracing=0
counter=0

if [ -z "$1" ] # -z returns true if $1 is null
	then
	printf "$0: illegal option $1\nusage: $0 [-t]... FILE... \nuse -? option for help\n"
	exit 1
else

while [ -n "$1" ] # while all arguments will not be read, -n returns true if not null
do
    if [ -z $(echo "$1" | tr -d ',') ]; then
        printf "$0: illegal option $1\nusage: $0 [-t]... FILE... \nuse -? option for help\n"
        exit 1
    else
        value=$(echo "$1" | tr -d ',')
    fi
	case "$value" in
		-t|--tracing) # check tracing
			shift
			tracing=1
		;;

		-?|--help) # check help bar
			shift
			printf "NAME
\t  $0 -- deletes files with matching suffix.

SYNOPSIS
\t  $0 FILE... 
\t  $0 [-?]

DESCRIPTION
\t  Compares the specified file with all other files that have the same suffix, with the deletion of matching files.
\t  -t, --tracing  enable tracing.
\t  -?, --help\t show help (this menu) and exits\n" 
		exit 1
		;;


    *) 
			if [ ! -f "$value" ] # -f is true if file exists and is a regular file.
			then
			    printf "$0: illegal option $value\nusage: $0 [-t]... FILE... \nuse -? option for help\n"
				exit 1 
		    else
		    	file=$value
		    	break	
		    fi
		;;

	esac
done #end of reading arguments
fi


#program
if [[ -z $file ]]; then
	printf "$0: illegal option $value\nusage: $0 [-t]... FILE... \nuse -? option for help\n"
	exit 1
fi

if [ $tracing -eq 1 ] 
		then
			set -x
fi


suf=$(echo $file | cut -f 2 -d.)
fail=$(find ./ -maxdepth 1 -name "*\.$suf" | grep -v $file)

for f in $fail
do
	if [ -e $f ] & $(cmp -s $file $f); then
	    rm $f
        (( counter++ ))
	fi
done

if [ $counter -eq 0 ]; then
    echo "There is the only file in this directory with specified suffix."
else
    printf "The program deleted %d file(s) with the same suffix as specified.\n" "$counter"
fi



exit 0
```

## 9. Дневник отладки

| №  | Лаб. или дом. | Дата       | Время | Событие   | Действие по исправлению | Примечание          |
|----|---------------|------------|-------|-----------|-------------------------|---------------------|
| 0  | Дом.          | 05.05.2022 | 21:30 | --        | --                      | Всё прошло исправно |

## 10. Замечания автора по существу работы
  Лабораторная работа показалась хоть и интересной, но трудоёмкой. Безусловно, в ходе её выполнения я смогла пополнить свои знания об интерпретируемых командных языках и UNIX-подобных системах.


## 11. Выводы
  В ходе выполнения этой лабораторной работы я познакомилась с bash-скриптами и составила программу выполнения заданных действий над файлами на одном из интерпретируемом языке согласно своему варианту.
